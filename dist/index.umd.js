(function(n,t){typeof exports=="object"&&typeof module!="undefined"?t(exports):typeof define=="function"&&define.amd?define(["exports"],t):(n=typeof globalThis!="undefined"?globalThis:n||self,t(n.yamiLoader={}))})(this,function(n){"use strict";var P=Object.defineProperty,$=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var E=(n,t,o)=>t in n?P(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,O=(n,t)=>{for(var o in t||(t={}))q.call(t,o)&&E(n,o,t[o]);if(w)for(var o of w(t))A.call(t,o)&&E(n,o,t[o]);return n},T=(n,t)=>$(n,R(t));var S=(n,t,o)=>(E(n,typeof t!="symbol"?t+"":t,o),o);var C=(n,t,o)=>new Promise((L,g)=>{var _=l=>{try{a(o.next(l))}catch(d){g(d)}},j=l=>{try{a(o.throw(l))}catch(d){g(d)}},a=l=>l.done?L(l.value):Promise.resolve(l.value).then(_,j);a((o=o.apply(n,t)).next())});var t=(d=>(d.LOAD="_load",d.ERROR="_error",d.COMPLETE="_complete",d))(t||{});const o=document.head||document.body,L="loaded",g=["body","frame","frameset","iframe","img","link","script","style"],_=(d,i)=>document.dispatchEvent(new CustomEvent(d,{detail:i}));function j(d,i,r){let e=r.id?o.querySelector("#"+r.id):null;if(!e){const h=`${i}[${i==="link"?"href":"src"}="${d}"]`;e=o.querySelector(h)}return e||(e=document.createElement(i),Object.assign(e,r),o.appendChild(e)),e}class a{constructor(i){S(this,"timeout",15*1e3);S(this,"LoaderEvent",t);Object.assign(this,i)}load(i,r={},e={}){const h=r.href||r.src;let s=j(h,i,r),c,v=0;return new Promise((u,m)=>{function f(){u({el:s,options:r})}function y(p){m({reason:typeof p=="string"?p:`Failed to load ${h}`,options:r})}if(g.includes(i))if(h){if(s.getAttribute(L)==="1")return f()}else return y("Not found the source address");else return f();s.addEventListener("load",f,!1),s.addEventListener("error",y,!1),c=()=>{var p;s.removeEventListener("load",f,!1),s.removeEventListener("error",y,!1),_("_complete",r),(p=e.oncomplete)==null||p.call(e,r),clearTimeout(v)},v=setTimeout(()=>y(`Time out of ${this.timeout} ms`),this.timeout)}).then(u=>{var m;return s.setAttribute(L,"1"),"_jsonp_"in r||(_("_load",u),(m=e.onload)==null||m.call(e,u.el,u.options)),u}).catch(u=>{var f;s.remove();const m={reason:u,options:r};return _("_error",m),(f=e.onerror)==null||f.call(e,u,r),Promise.reject(m)}).finally(c)}loadScript(i,r,e){return this.load("script",T(O({},r),{defer:!0,async:!0,type:"text/javascript",crossOrigin:"anonymous",src:i}),e)}loadCss(i,r,e){return this.load("link",T(O({},r),{rel:"stylesheet",type:"text/css",crossOrigin:"anonymous",href:i}),e)}loadJson(i,r,e){return C(this,null,function*(){const[h,s]=i.split("?"),c=new URLSearchParams(s);c.append(r.name||"jsonCallback",r.callee);const v=e==null?void 0:e.onload;e==null||delete e.onload;const{el:u,options:m}=yield this.loadScript(h+"?"+c.toString(),Object.assign(r,{_jsonp_:!0}),e),f=globalThis[r.callee]();globalThis[r.callee]=null,u.remove();const y={data:f,options:m};return _("_load",y),v==null||v.call(e,f,m),y})}}const l=new a;n.LoaderEvent=t,n.YamiLoader=a,n.default=a,n.yamiLoader=l,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
