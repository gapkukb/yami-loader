(function(r,t){typeof exports=="object"&&typeof module!="undefined"?t(exports):typeof define=="function"&&define.amd?define(["exports"],t):(r=typeof globalThis!="undefined"?globalThis:r||self,t(r.yamiLoader={}))})(this,function(r){"use strict";var C=Object.defineProperty,S=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var w=(r,t,i)=>t in r?C(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i,p=(r,t)=>{for(var i in t||(t={}))P.call(t,i)&&w(r,i,t[i]);if(T)for(var i of T(t))$.call(t,i)&&w(r,i,t[i]);return r},E=(r,t)=>S(r,j(t));var O=(r,t,i)=>new Promise((c,f)=>{var v=e=>{try{y(i.next(e))}catch(n){f(n)}},h=e=>{try{y(i.throw(e))}catch(n){f(n)}},y=e=>e.done?c(e.value):Promise.resolve(e.value).then(v,h);y((i=i.apply(r,t)).next())});var t=(e=>(e.LOAD="load",e.ERROR="error",e.COMPLETE="complete",e))(t||{});const i=document.head||document.getElementsByTagName("head")[0]||document.body,c="loaded",f=["body","frame","frameset","iframe","img","link","script","style"];function v(e,n,o){let s=o.id?document.getElementById(o.id):null;if(!s){const d=`${n}[${n==="link"?"href":"src"}="${e}"]`;s=i.querySelector(d)}return s||(s=document.createElement(n),Object.assign(s,o),i.appendChild(s)),s}const h={LoaderEvent:t,load(e,n={},o={}){const s=n.src||n.href;let d=v(s,e,n);if(!f.includes(e)||d.getAttribute(c)==="1")return Promise.resolve(d);let a;return new Promise((l,u)=>{function m(){l(d)}function _(){u(`Failed to load ${s}`)}d.addEventListener("load",m,!1),d.addEventListener("error",_,!1),a=()=>{var L;d.removeEventListener("load",m,!1),d.removeEventListener("error",_,!1),document.dispatchEvent(new CustomEvent("complete",{detail:d})),(L=o.oncomplete)==null||L.call(o,d)};const g=15*1e3;setTimeout(()=>u(`Time out of ${g}ms`),g)}).then(l=>{var u;return d.setAttribute(c,"1"),document.dispatchEvent(new CustomEvent("load",{detail:d})),(u=o.onload)==null||u.call(o,d),l}).catch(l=>{var u;throw d.remove(),document.dispatchEvent(new CustomEvent("error",{detail:l})),(u=o.onerror)==null||u.call(o,l),new Error(l)}).finally(a)},loadScript(e,n,o){return this.load("script",E(p({},n),{defer:!0,async:!0,type:"text/javascript",crossOrigin:"anonymous",src:e}),o)},loadCss(e,n,o){return this.load("link",E(p({},n),{rel:"stylesheet",type:"text/css",crossOrigin:"anonymous",href:e}),o)},jsonp(e,n){return O(this,null,function*(){const[o,s]=e.split("?"),d=new URLSearchParams(s);d.append(n.name||"jsonCallback",n.callee);const a=Object.create(n.callbacks||{}),l=a.onload;delete a.onload;const u=yield this.loadScript(o+"?"+d.toString(),void 0,a),m=globalThis[n.callee]();return globalThis[n.callee]=null,u.remove(),l==null||l.call(n,m),m})}};r.LoaderEvent=t,r.default=h,r.yamiLoader=h,Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
