(function(o,n){typeof exports=="object"&&typeof module!="undefined"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(o=typeof globalThis!="undefined"?globalThis:o||self,n(o.yamiLoader={}))})(this,function(o){"use strict";var O=Object.defineProperty,S=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var _=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,P=Object.prototype.propertyIsEnumerable;var L=(o,n,d)=>n in o?O(o,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):o[n]=d,v=(o,n)=>{for(var d in n||(n={}))C.call(n,d)&&L(o,d,n[d]);if(_)for(var d of _(n))P.call(n,d)&&L(o,d,n[d]);return o},y=(o,n)=>S(o,j(n));var T=(o,n,d)=>new Promise((f,h)=>{var m=e=>{try{r(d.next(e))}catch(t){h(t)}},w=e=>{try{r(d.throw(e))}catch(t){h(t)}},r=e=>e.done?f(e.value):Promise.resolve(e.value).then(m,w);r((d=d.apply(o,n)).next())});var n=(r=>(r.LOAD="load",r.ERROR="error",r.COMPLETE="complete",r))(n||{});const d=document.head||document.getElementsByTagName("head")[0]||document.body,f="loaded";function h(r,e,t){let l=t.id?document.getElementById(t.id):null;if(!l){const i=`${e}[${e==="link"?"href":"src"}="${r}"]`;l=d.querySelector(i)}return l||(l=document.createElement(e),Object.assign(l,t),d.appendChild(l)),l}const m={LoaderEvent:n,load(r,e={},t={}){const l=e.src||e.href;let i=h(l,r,e);if(i.getAttribute(f)==="1")return Promise.resolve(i);let u;return new Promise((s,a)=>{function c(){s(i)}function p(){a(`Failed to load ${l}`)}i.addEventListener("load",c,!1),i.addEventListener("error",p,!1),u=()=>{var g;i.removeEventListener("load",c,!1),i.removeEventListener("error",p,!1),document.dispatchEvent(new CustomEvent("complete",{detail:i})),(g=t.oncomplete)==null||g.call(t,i)};const E=15*1e3;setTimeout(()=>a(`Time out of ${E}ms`),E)}).then(s=>{var a;return i.setAttribute(f,"1"),document.dispatchEvent(new CustomEvent("load",{detail:i})),(a=t.onload)==null||a.call(t,i),s}).catch(s=>{var a;throw i.remove(),document.dispatchEvent(new CustomEvent("error",{detail:s})),(a=t.onerror)==null||a.call(t,s),new Error(s)}).finally(u)},loadScript(r,e,t){return this.load("script",y(v({},e),{defer:!0,async:!0,type:"text/javascript",crossOrigin:"anonymous",src:r}),t)},loadCss(r,e,t){return this.load("link",y(v({},e),{rel:"stylesheet",type:"text/css",crossOrigin:"anonymous",href:r}),t)},jsonp(r,e){return T(this,null,function*(){const[t,l]=r.split("?"),i=new URLSearchParams(l);i.append(e.name||"jsonCallback",e.callee);const u=Object.create(e.callbacks||{}),s=u.onload;delete u.onload;const a=yield this.loadScript(t+"?"+i.toString(),void 0,u),c=globalThis[e.callee]();return globalThis[e.callee]=null,a.remove(),s==null||s.call(e,c),c})}};m.loadScript("demo.js",void 0,{onload(r){console.log(this),console.log(r)}}),o.LoaderEvent=n,o.default=m,o.yamiLoader=m,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
